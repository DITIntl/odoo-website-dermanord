<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="search_result" inherit_id="website_fts.search_result">
            <xpath expr="//t[@t-foreach='terms']" position="replace">
                <script>var dermanord_kw = "<t t-esc='kw'/>";</script>
                <t t-foreach="terms" t-as="term">
                    <t t-if="term.res_model == 'product.template'">
                        <t t-if="term.model_record.image">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <img class="img img-responsive" t-att-src="'/imagefield/product.template/image/%s/ref/%s' %(term.res_id, 'webshop_dermanord.img_search_result')"/>
                            </div>
                        </t>
                        <div t-att-class="'col-md-9 col-sm-9 col-xs-9' if term.model_record.image else 'col-md-12 col-sm-12 col-xs-12'">
                            <a t-att-href="'/shop/product/%s' %term.res_id">
                                <h3><t t-esc="term.model_record.name"/></h3>
                            </a>
                            <h4 class="text-muted"><t t-esc="term.model_record.description_sale"/></h4>
                        </div>
                    </t>
                    <t t-if="term.res_model == 'product.product'">
                        <t t-if="term.model_record.image">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <img class="img img-responsive" t-att-src="'/imagefield/product.product/image/%s/ref/%s' %(term.res_id, 'webshop_dermanord.img_search_result')"/>
                            </div>
                        </t>
                        <div t-att-class="'col-md-9 col-sm-9 col-xs-9' if term.model_record.image else 'col-md-12 col-sm-12 col-xs-12'">
                            <a t-att-href="'/shop/variant/%s' %term.res_id">
                                <h3><t t-esc="term.model_record.name"/></h3>
                            </a>
                            <t t-foreach="term.model_record.attribute_value_ids" t-as="value">
                                <span class="dn_tags" t-esc="'%s ' %value.name"/>
                            </t>
                            <h4 class="text-muted"><t t-esc="term.model_record.product_tmpl_id.description_sale"/></h4>
                        </div>
                    </t>
                    <t t-if="term.res_model == 'product.public.category'">
                        <t t-if="term.model_record.image_medium">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <img class="img img-responsive" t-att-src="'/imagefield/product.public.category/image_medium/%s/ref/%s' %(term.res_id, 'webshop_dermanord.img_search_result')"/>
                            </div>
                        </t>
                        <div t-att-class="'col-md-9 col-sm-9 col-xs-9' if term.model_record.image_medium else 'col-md-12 col-sm-12 col-xs-12'">
                            <a t-att-href="'/shop/category/%s' %term.res_id">
                                <h3><t t-esc="term.model_record.name"/></h3>
                            </a>
                        </div>
                    </t>
                    <t t-if="term.res_model == 'blog.post'">
                        <t t-if="term.model_record.background_image">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <img class="img img-responsive" t-att-src="'/imagefield/blog.post/background_image/%s/ref/%s' %(term.res_id, 'webshop_dermanord.img_search_result')"/>
                            </div>
                        </t>
                        <div t-att-class="'col-md-9 col-sm-9 col-xs-9' if term.model_record.background_image else 'col-md-12 col-sm-12 col-xs-12'">
                            <a t-att-href="'/blog/%s/post/%s' %(request.env['blog.post'].browse(term.res_id).blog_id.id, term.res_id)">
                                <h3><t t-esc="term.model_record.name"/></h3>
                            </a>
                            <h4 class="text-muted"><t t-esc="term.model_record.subtitle"/></h4>
                        </div>
                    </t>
                    <t t-if="term.res_model == 'product.facet.line'">
                        <t t-if="term.model_record.product_tmpl_id.image">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <img class="img img-responsive" t-att-src="'/imagefield/product.template/image/%s/ref/%s' %(term.model_record.product_tmpl_id.id, 'webshop_dermanord.img_search_result')"/>
                            </div>
                        </t>
                        <div t-att-class="'col-md-9 col-sm-9 col-xs-9' if term.model_record.product_tmpl_id.image else 'col-md-12 col-sm-12 col-xs-12'">
                            <a t-att-href="'/shop/product/%s' %term.model_record.product_tmpl_id">
                                <h3><t t-esc="term.model_record.product_tmpl_id.name"/></h3>
                            </a>
                            <t t-foreach="term.model_record.product_tmpl_id.facet_line_ids.with_context({'res_id': term.res_id}).filtered(lambda f: f.id == f._context.get('res_id'))[0].value_ids" t-as="value">
                                <span class="dn_facets" t-esc="'%s ' %value.name"/>
                            </t>
                            <h4 class="text-muted"><t t-esc="term.model_record.product_tmpl_id.description_sale"/></h4>
                        </div>
                    </t>
                </t>
            </xpath>
        </template>

        <template id="webshop_dermanord" inherit_id="website.layout" name="Webshop Dermanord">
            <!-- Customize css -->
            <xpath expr="//t[@t-call-assets='website.assets_frontend']" position="before">
                <link href="/webshop_dermanord/static/src/css/webshop_dermanord.css" rel="stylesheet" />
            </xpath>
        </template>

        <template id="assets_frontend_override" inherit_id="website_sale.assets_frontend">
            <!-- Customize javascript -->
            <xpath expr="//script[@src='/website_sale/static/src/js/website_sale.js']" position="replace">
                <script type="text/javascript" src="/webshop_dermanord/static/src/js/webshop_dermanord.js" />
            </xpath>
            <xpath expr="//script[last()]" position="after">
                <script type="text/javascript" src="/webshop_dermanord/static/src/js/webshop_search.js" />
            </xpath>
        </template>

        <record id="view_blog_post_form" model="ir.ui.view">
            <field name="name">blog.post.form.webshop</field>
            <field name="model">blog.post</field>
            <field name="inherit_id" ref="website_blog.view_blog_post_form" />
            <field name="arch" type="xml">
                <sheet position="inside">
                    <group>
                        <field name="product_tmpl_ids" widget="many2many_tags" />
                        <field name="product_public_categ_ids" widget="many2many_tags" />
                    </group>
                </sheet>
            </field>
        </record>
        <record id="product_public_category_form_view" model="ir.ui.view">
            <field name="name">product.public.category.form.inherited.webshop_dermanord</field>
            <field name="model">product.public.category</field>
            <field name="inherit_id" ref="website_sale.product_public_category_form_view"/>
            <field name="arch" type="xml">
                <field name="sequence" position="attributes">
                    <attribute name="widget">handle</attribute>
                </field>
            </field>
        </record>

        <record id="product_pricelist_view" model="ir.ui.view">
            <field name="name">product.pricelist.form.inherited.webshop_dermanord</field>
            <field name="model">product.pricelist</field>
            <field name="inherit_id" ref="product.product_pricelist_view"/>
            <field name="arch" type="xml">
                <field name="active" position="after">
                    <field name="for_reseller"/>
                </field>
            </field>
        </record>

        <record id="product_template_form_view" model="ir.ui.view">
            <field name="name">product.template.common.form.inherited.webshop_dermanord</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_form_view"/>
            <field name="arch" type="xml">
                <field name="list_price" position="after">
                    <field name="sold_times"/>
                </field>
            </field>
        </record>

    </data>
</openerp>
