<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="main_filter_sort_layout" inherit_id="website.layout">
            <xpath expr="//div[@id='wrapwrap']/main" position="inside">
                <t t-set="filter_facets" t-value="request.env['product.facet'].search([])"/>
                <t t-set="filter_categories" t-value="request.env['product.public.category'].search([])"/>
                <t t-set="filter_ingredients" t-value="request.env['product.ingredient'].search([])"/>
                <div id="dn_filter_modal" class="modal fade" role="dialog">
                    <div class="modal-dialog" style="margin: 0px;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Product Filter
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&amp;times;</span>
                                    </button>
                                </h5>
                            </div>
                            <div class="modal-body" style="padding: 0px;">
                                <t t-call="webshop_dermanord.dn_filter_form"/>
                            </div>
                            <div class="modal-footer hidden">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="dn_sort_modal" class="modal fade" role="dialog">
                    <div class="modal-dialog" style="margin: 0px;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Product Sort
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&amp;times;</span>
                                    </button>
                                </h5>
                            </div>
                            <div class="modal-body">
                                <t t-call="webshop_dermanord.dn_sort_form"/>
                            </div>
                            <div class="modal-footer hidden">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="bottom_div" class="container">
                    <h4 id="filter-btn-modal" data-toggle="modal" data-target="#dn_filter_modal" class="pull-left"><i class="fa fa-filter"/> Filter</h4>
                    <h4 id="sort-btn-modal" data-toggle="modal" data-target="#dn_sort_modal" class="pull-right"><i class="fa fa-sort"/> Sort</h4>
                </div>
            </xpath>
        </template>

        <template id="dn_filter_form" name="DN Filter Form">
            <form t-att-action="'/dn_list' if url == '/dn_list' else '/dn_shop'" method="post">
                <div class="container">
                    <t t-set="first_facet" t-value="0"/>
                    <t t-if="len(filter_facets) &gt; 0">
                        <div class="col-md-5 col-sm-5 col-xs-5">
                            <t t-call="webshop_dermanord.dn_filter_navigator"/>
                        </div>
                        <div class="col-md-7 col-sm-7 col-xs-7">
                            <t t-call="webshop_dermanord.dn_filter_content"/>
                        </div>
                    </t>
                </div>
                <div id="filter_btn_group" class="btn-group">
                    <button class="mt32 dn_btn dn_primary" type="submit">OK</button>
                    <button class="mt32 dn_btn dn_default" type="button" onclick="restore_filter()"><i class="fa fa-trash-o"/> Restore</button>
                </div>
            </form>
        </template>

        <template id="dn_filter_navigator" name="DN Filter Navigator">
            <ul class="nav nav-stacked">
                <t t-foreach="filter_facets" t-as="facet">
                    <li t-att-class="'active' if facet_index == 0 else ''">
                        <a data-toggle="tab" t-att-href="'#facet_%s' %facet.id">
                            <h5>
                                <span t-esc="facet.name"/>
                                <t t-set="facet_values" t-value="request.env['product.facet.value'].search([('facet_id', '=', facet.id)])"/>
                                <t t-if="len(facet_values) &gt; 0 and form_values">
                                    <t t-set="facet_values_count" t-value="0"/>
                                    <t t-foreach="facet_values" t-as="facet_value">
                                        <t t-if="'facet_%s_%s' %(facet.id, facet_value.id) in form_values.keys()">
                                            <t t-set="facet_values_count" t-value="facet_values_count + 1"/>
                                        </t>
                                    </t>
                                    <t t-if="facet_values_count != 0">
                                        <span class="filter_match" t-esc="facet_values_count"/>
                                    </t>
                                </t>
                                <i class="fa fa-angle-right"/>
                            </h5>
                        </a>
                    </li>
                </t>
                <li>
                    <a data-toggle="tab" href="#category">
                        <h5>Categories
                            <t t-if="len(filter_categories) &gt; 0 and form_values">
                                <t t-set="category_count" t-value="0"/>
                                <t t-foreach="filter_categories" t-as="category">
                                    <t t-if="'category_%s' %category.id in form_values.keys()">
                                        <t t-set="category_count" t-value="category_count + 1"/>
                                    </t>
                                </t>
                                <t t-if="category_count != 0">
                                    <span class="filter_match" t-esc="category_count"/>
                                </t>
                            </t>
                            <i class="fa fa-angle-right"/>
                        </h5>
                    </a>
                </li>
                <li>
                    <a data-toggle="tab" href="#ingredient">
                        <h5>Ingredients
                            <t t-if="len(filter_ingredients) &gt; 0 and form_values">
                                <t t-set="ingredient_count" t-value="0"/>
                                <t t-foreach="filter_ingredients" t-as="ingredient">
                                    <t t-if="'ingredient_%s' %ingredient.id in form_values.keys()">
                                        <t t-set="ingredient_count" t-value="ingredient_count + 1"/>
                                    </t>
                                </t>
                                <t t-if="ingredient_count != 0">
                                    <span class="filter_match" t-esc="ingredient_count"/>
                                </t>
                            </t>
                            <i class="fa fa-angle-right"/>
                        </h5>
                    </a>
                </li>
            </ul>
        </template>

        <template id="dn_filter_content" name="DN Filter Content">
            <div class="tab-content">
                <t t-foreach="filter_facets" t-as="facet">
                    <t t-set="facet_values" t-value="request.env['product.facet.value'].search([('facet_id', '=', facet.id)])"/>
                    <div t-att-id="'facet_%s' %facet.id" t-att-class="'tab-pane fade %s' %('in active' if facet_index == 0 else '')">
                        <t t-if="len(facet_values) &gt; 0">
                            <t t-foreach="facet_values" t-as="facet_value">
                                <div class="checkbox">
                                    <h5>
                                        <label>
                                            <t t-if="form_values">
                                                <input type="checkbox" t-att-name="'facet_%s_%s' %(facet.id, facet_value.id)" t-att-value="facet_value.id" t-att="{'checked': '1'} if (form_values.get('facet_%s_%s' %(facet.id, facet_value.id)) and form_values.get('facet_%s_%s' %(facet.id, facet_value.id)) == str(facet_value.id)) else {}"/><t t-esc="facet_value.name"/></t>
                                            <t t-if="not form_values">
                                                <input type="checkbox" t-att-name="'facet_%s_%s' %(facet.id, facet_value.id)" t-att-value="facet_value.id"/><t t-esc="facet_value.name"/>
                                            </t>
                                        </label>
                                    </h5>
                                </div>
                            </t>
                        </t>
                    </div>
                </t>
                <div id="category" class="tab-pane fade">
                    <t t-if="len(filter_categories) &gt; 0">
                        <t t-foreach="filter_categories" t-as="category">
                            <div class="checkbox">
                                <h5>
                                    <label>
                                        <t t-if="form_values">
                                            <input type="checkbox" t-att-name="'category_%s' %category.id" t-att-value="category.id" t-att="{'checked': '1'} if form_values.get('category_%s' %category.id) == str(category.id) else {}"/><t t-esc="category.name"/>
                                        </t>
                                        <t t-if="not form_values">
                                            <input type="checkbox" t-att-name="'category_%s' %category.id" t-att-value="category.id"/><t t-esc="category.name"/>
                                        </t>
                                    </label>
                                </h5>
                            </div>
                        </t>
                    </t>
                </div>
                <div id="ingredient" class="tab-pane fade">
                    <t t-if="len(filter_ingredients) &gt; 0">
                        <t t-foreach="filter_ingredients" t-as="ingredient">
                            <div class="checkbox">
                                <h5>
                                    <label>
                                        <t t-if="form_values">
                                            <input type="checkbox" t-att-name="'ingredient_%s' %ingredient.id" t-att-value="ingredient.id" t-att="{'checked': '1'} if form_values.get('ingredient_%s' %ingredient.id) == str(ingredient.id) else {}"/><t t-esc="ingredient.name"/></t>
                                        <t t-if="not form_values">
                                            <input type="checkbox" t-att-name="'ingredient_%s' %ingredient.id" t-att-value="ingredient.id"/><t t-esc="ingredient.name"/>
                                        </t>
                                    </label>
                                </h5>
                            </div>
                        </t>
                    </t>
                </div>
                <t t-if="form_values">
                    <input type="hidden" name="order" t-att-value="form_values.get('order') if form_values.get('order') else 'name asc'"/>
                </t>
            </div>
        </template>

        <template id="dn_sort_form" name="DN Sort Form">
            <form t-att-action="'/dn_list' if url == '/dn_list' else '/dn_shop'" method="post">
                <div class="container">
                    <ul>
                        <li><div class="radio"><label>
                            <t t-if="form_values">
                                <input type="radio" name="order" value="sold_qty desc" t-att="{'checked': '1'} if form_values.get('order') == 'sold_qty desc' else {}"/> Most Sold
                            </t>
                            <t t-if="not form_values">
                                <input type="radio" name="order" value="sold_qty desc" checked="1"/> Most Sold
                            </t>
                        </label></div></li>
                        <li><div class="radio"><label>
                            <t t-if="form_values">
                                <input type="radio" name="order" value="name asc" t-att="{'checked': '1'} if form_values.get('order') == 'name asc' else {}"/> Name Ascending
                            </t>
                            <t t-if="not form_values">
                                <input type="radio" name="order" value="name asc"/> Name Ascending
                            </t>
                        </label></div></li>
                        <li><div class="radio"><label>
                            <t t-if="form_values">
                                <input type="radio" name="order" value="name desc" t-att="{'checked': '1'} if form_values.get('order') == 'name desc' else {}"/> Name Descending
                            </t>
                            <t t-if="not form_values">
                                <input type="radio" name="order" value="name desc"/> Name Descending
                            </t>
                        </label></div></li>
                        <li><div class="radio"><label>
                            <t t-if="form_values">
                                <input type="radio" name="order" value="list_price asc" t-att="{'checked': '1'} if form_values.get('order') == 'list_price asc' else {}"/> Price Ascending
                            </t>
                            <t t-if="not form_values">
                                <input type="radio" name="order" value="list_price asc"/> Price Ascending
                            </t>
                        </label></div></li>
                        <li><div class="radio"><label>
                            <t t-if="form_values">
                                <input type="radio" name="order" value="list_price desc" t-att="{'checked': '1'} if form_values.get('order') == 'list_price desc' else {}"/> Price Descending
                            </t>
                            <t t-if="not form_values">
                                <input type="radio" name="order" value="list_price desc"/> Price Descending
                            </t>
                        </label></div></li>
                        <t t-if="user_id.partner_id.property_product_pricelist and user_id.partner_id.property_product_pricelist.for_reseller">
                            <li><div class="radio"><label>
                                <t t-if="form_values">
                                    <input type="radio" name="order" value="default_code asc" t-att="{'checked': '1'} if form_values.get('order') == 'default_code asc' else {}"/> Article No. Ascending
                                </t>
                                <t t-if="not form_values">
                                    <input type="radio" name="order" value="default_code asc"/> Article No. Ascending
                                </t>
                            </label></div></li>
                            <li><div class="radio"><label>
                                <t t-if="form_values">
                                    <input type="radio" name="order" value="default_code desc" t-att="{'checked': '1'} if form_values.get('order') == 'default_code desc' else {}"/> Article No. Descending
                                </t>
                                <t t-if="not form_values">
                                    <input type="radio" name="order" value="default_code desc"/> Article No. Descending
                                </t>
                            </label></div></li>
                        </t>
                    </ul>
                </div>
                <t t-foreach="filter_facets" t-as="facet">
                    <t t-set="facet_values" t-value="request.env['product.facet.value'].search([('facet_id', '=', facet.id)])"/>
                    <t t-if="len(facet_values) &gt; 0">
                        <t t-foreach="facet_values" t-as="facet_value">
                            <t t-if="form_values">
                                <input type="hidden" t-att-name="'facet_%s_%s' %(facet.id, facet_value.id)" t-att-value="form_values.get('facet_%s_%s' %(facet.id, facet_value.id)) if form_values.get('facet_%s_%s' %(facet.id, facet_value.id)) else ''"/>
                            </t>
                        </t>
                    </t>
                </t>
                <t t-if="len(filter_categories) &gt; 0">
                    <t t-foreach="filter_categories" t-as="category">
                        <t t-if="form_values">
                            <input type="hidden" t-att-name="'category_%s' %category.id" t-att-value="form_values.get('category_%s' %category.id) if form_values.get('category_%s' %category.id) else ''"/>
                        </t>
                    </t>
                </t>
                <t t-if="len(filter_ingredients) &gt; 0">
                    <t t-foreach="filter_ingredients" t-as="ingredient">
                        <t t-if="form_values">
                            <input type="hidden" t-att-name="'ingredient_%s' %ingredient.id" t-att-value="form_values.get('ingredient_%s' %ingredient.id) if form_values.get('ingredient_%s' %ingredient.id) else ''"/>
                        </t>
                    </t>
                </t>
                <button class="mt32 dn_btn dn_primary" type="submit">OK</button>
            </form>
        </template>

    </data>
</openerp>
